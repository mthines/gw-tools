#!/usr/bin/env sh

# Get the default branch (main or master)
DEFAULT_BRANCH=$(git remote show origin 2>/dev/null | grep 'HEAD branch' | cut -d':' -f2 | tr -d ' ' || echo "main")

# Format changed files using Nx
echo "Running nx format:write for changed files..."
npx nx format:write --base="origin/${DEFAULT_BRANCH}" --head=HEAD

# Check if there are any uncommitted changes after formatting
if ! git diff --quiet; then
  echo ""
  echo "Formatting changes detected. Auto-committing..."
  git diff --name-only
  echo ""
  git add -A
  git commit -m "chore: autofix"
  echo "Auto-committed formatting changes."
fi

echo "Formatting check passed!"
